# Day 04：邏輯回歸 (Logistic Regression) —— 生死一線間

## 0. 前情提要與故事線 (Storyline)

在 Day 02 與 Day 03，我們利用加州房價資料集，學會了如何預測一個 **「連續數值」** (房價)。但現實生活中，我們更常遇到的是 **「是非題」**：
* 這封郵件是垃圾信嗎？(是/否)
* 這張照片是貓還是狗？(類別)
* **這位乘客能從鐵達尼號倖存嗎？(生存/死亡)**

今天，我們開啟新的故事線 —— **鐵達尼號生存預測**。我們將使用最經典的分類演算法：**邏輯回歸 (Logistic Regression)**，試圖從數據中找出「誰能活下來」的數學規則。

---

## 1. 理論基礎：把直線「壓彎」 (From Linear to Logistic)

你可能會問：「為什麼不能直接用 Day 02 的線性回歸來預測生存？」

因為線性回歸的輸出是 $-\infty$ 到 $+\infty$，它可能會算出「生存率 120%」或是「生存率 -30%」，這是不合理的。我們需要一個函數，把輸出強行壓縮在 **0 到 1** 之間（代表機率）。

這個神奇的函數就是 **Sigmoid 函數**：

$$\sigma(z) = \frac{1}{1 + e^{-z}}$$

### 1.1 決策邊界 (Decision Boundary)
邏輯回歸的核心運作方式：
1.  先像線性回歸一樣算出一個分數：$z = w_1x_1 + w_2x_2 + b$
2.  把 $z$ 丟進 Sigmoid 函數變成機率 $P$。
3.  設定門檻（通常是 0.5）：
    * 如果 $P > 0.5$ $\rightarrow$ 預測為 **生存 (1)**
    * 如果 $P < 0.5$ $\rightarrow$ 預測為 **死亡 (0)**

---

## 2. 實驗設計：鐵達尼號數據 (The Titanic Experiment)

我們使用 Python 的 `sklearn` 來實作。為了讓電腦讀懂資料，我們做了兩件重要的預處理：

1.  **填補缺失值 (Missing Values)：** 很多乘客的年齡是空的，我們用「中位數」填補，避免誤導模型。
2.  **獨熱編碼 (One-Hot Encoding)：** 電腦看不懂 "Male" 和 "Female"。我們將其轉換為：
    * `sex_male = 1` 代表男性
    * `sex_male = 0` 代表女性

### 2.1 混淆矩陣 (Confusion Matrix)
模型跑完後，準確率大約落在 **81%** 左右。但光看準確率是不夠的，我們來看 **混淆矩陣**：

| | 預測：死亡 (0) | 預測：生存 (1) |
| :--- | :---: | :---: |
| **實際：死亡 (0)** | **90 (TN)** | 15 (FP) |
| **實際：生存 (1)** | 20 (FN) | **54 (TP)** |

* **TP (True Positive):** 54 人，模型猜他活，他也真的活了。
* **TN (True Negative):** 90 人，模型猜他死，他也真的不幸罹難。
* **遺憾的錯誤 (FN):** 20 人，模型以為他們會死（可能因為是三等艙男性），結果他們奇蹟生還。

---

## 3. 深度分析：誰最容易活下來？

邏輯回歸最大的優點是 **「可解釋性 (Explainability)」**。我們可以看模型的 **係數 (Coefficients)** 來理解它學到了什麼規則。



我們從權重圖中觀察到了驚人的社會階級與性別現象：

### 3.1 `Sex_male` (權重約 -2.5)
這是**負值最大**的特徵（紅色長條）。
* **解讀：** 只要你是「男性」，算出來的生存分數就會被重扣 2.5 分。
* **現實對應：** 這完美反映了當時 "Women and children first" (婦孺優先) 的逃生準則。

### 3.2 `Pclass` (權重約 -0.9)
這也是負值。
* **解讀：** 艙等數字越大 (3等艙)，生存機率越低。
* **現實對應：** 頭等艙離甲板最近，三等艙在最底層，且逃生動線受阻。

### 3.3 `Age` (權重約 -0.3)
稍微負值。
* **解讀：** 年紀越大，生存機率略微下降（優先救小孩）。

---

## 4. 總結與反思 (Conclusion)

今天我們建立了一個準確率約 81% 的模型。它學會了一條簡單的規則：**「如果你是坐頭等艙的女性，那你大概率會活下來。」**

### 邏輯回歸的局限
邏輯回歸畫出的 **決策邊界 (Decision Boundary)** 是一條 **「直線」**。
它假設「年齡」與「生存」是簡單的線性關係。但試想：如果是 **1 歲嬰兒** (生存率高) 和 **60 歲長者** (生存率低)，中間的 **25 歲壯年人** (生存率可能又不同)，這種「非線性」的關係，邏輯回歸能處理得好嗎？

### Next Step:
如果這條「生與死」的界線不是直線，而是像地圖上一樣彎彎曲曲的呢？
**Day 05 - K-近鄰演算法 (KNN)** 將登場。我們將拋棄畫線的想法，改用「物以類聚」的直覺來重新挑戰鐵達尼號預測！